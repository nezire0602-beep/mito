<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>深音 - mito</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%23f5d6c3'/%3E%3Cstop offset='100%25' stop-color='%23e8a0b4'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='14' fill='url(%23bg)'/%3E%3Ctext x='32' y='44' text-anchor='middle' font-family='Georgia,serif' font-size='34' font-weight='bold' font-style='italic' fill='%236b3a4a'%3Em%3C/text%3E%3Ccircle cx='48' cy='14' r='5' fill='%23d4708a' opacity='.5'/%3E%3Ccircle cx='44' cy='11' r='3' fill='%23e8a0b4' opacity='.6'/%3E%3C/svg%3E">
<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0%25' stop-color='%23fdf6ee'/%3E%3Cstop offset='50%25' stop-color='%23f5d6c3'/%3E%3Cstop offset='100%25' stop-color='%23e8a0b4'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='180' height='180' rx='40' fill='url(%23bg)'/%3E%3Ctext x='90' y='120' text-anchor='middle' font-family='Georgia,serif' font-size='90' font-weight='bold' font-style='italic' fill='%236b3a4a'%3Em%3C/text%3E%3Ccircle cx='135' cy='38' r='14' fill='%23d4708a' opacity='.4'/%3E%3Ccircle cx='126' cy='30' r='8' fill='%23e8a0b4' opacity='.5'/%3E%3C/svg%3E">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Caveat:wght@400;600&display=swap" rel="stylesheet">
<!-- Firebase SDK (CDN) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<style>
:root{--warm:#fdf6ee;--cream:#faf3e8;--peach:#f5d6c3;--blush:#e8a0b4;--rose:#d4708a;--deep:#6b3a4a;--text:#4a3030;--text-light:#9a7a7a;--gold:#c8a46e;--gold-light:#e8d5b0;--tab-bg:#fff9f3}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Zen Maru Gothic',sans-serif;background:var(--warm);color:var(--text);min-height:100dvh;overflow-x:hidden}
.hero{position:relative;width:100%;height:55dvh;min-height:320px;overflow:hidden}
.hero img{width:100%;height:100%;object-fit:cover;object-position:center 30%;display:block}
.hero-overlay{position:absolute;bottom:0;left:0;right:0;height:60%;background:linear-gradient(to top,var(--warm) 0%,rgba(253,246,238,.7) 40%,transparent 100%);pointer-events:none}
.hero-text{position:absolute;bottom:24px;left:0;right:0;text-align:center;z-index:2}
.hero-name{font-family:'Caveat',cursive;font-size:3.2rem;font-weight:600;color:var(--deep);letter-spacing:.05em;line-height:1;margin-bottom:2px}
.hero-name-jp{font-size:1.1rem;font-weight:500;color:var(--rose);letter-spacing:.3em;margin-bottom:6px}
.hero-birthday{font-size:.75rem;color:var(--text-light);letter-spacing:.1em}
.hero-birth-stats{font-size:.7rem;color:var(--text-light);letter-spacing:.05em;margin-top:2px}
.hero-days{display:inline-block;margin-top:8px;padding:4px 16px;background:rgba(255,255,255,.7);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:20px;font-size:.8rem;color:var(--rose);font-weight:500;border:1px solid rgba(212,112,138,.15)}
.tab-bar{position:sticky;top:0;z-index:100;background:var(--tab-bg);border-bottom:1px solid rgba(200,164,110,.15);display:flex;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding:0 4px;box-shadow:0 1px 8px rgba(107,58,74,.05)}
.tab-bar::-webkit-scrollbar{display:none}
.tab-btn{flex:0 0 auto;padding:11px 14px 9px;border:none;background:none;font-family:'Zen Maru Gothic',sans-serif;font-size:.72rem;font-weight:500;color:var(--text-light);cursor:pointer;position:relative;transition:color .25s ease;display:flex;flex-direction:column;align-items:center;gap:2px;white-space:nowrap}
.tab-btn .tab-icon{font-size:1.1rem;line-height:1}
.tab-btn.active{color:var(--rose)}
.tab-btn.active::after{content:'';position:absolute;bottom:0;left:16%;right:16%;height:2.5px;background:var(--rose);border-radius:2px 2px 0 0}
.tab-btn:active{opacity:.7}
.tab-content{display:none;padding:16px 16px 100px;animation:fadeIn .3s ease}
.tab-content.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.section-title{font-size:.85rem;font-weight:700;color:var(--deep);margin-bottom:12px}
.today-summary{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.summary-chip{flex:1;min-width:65px;text-align:center;padding:10px 4px;background:#fff;border-radius:12px;border:1px solid rgba(200,164,110,.15)}
.summary-chip .num{font-size:1.2rem;font-weight:700;color:var(--deep);line-height:1.2}
.summary-chip .label{font-size:.6rem;color:var(--text-light);margin-top:2px}
.record-form{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px;border:1px solid rgba(200,164,110,.12)}
.form-row{margin-bottom:12px}
.form-label{font-size:.72rem;color:var(--text-light);margin-bottom:6px;display:block}
.type-btns{display:flex;gap:6px;flex-wrap:wrap}
.type-btn{padding:8px 14px;border-radius:20px;border:1.5px solid var(--gold-light);background:#fff;font-family:'Zen Maru Gothic',sans-serif;font-size:.78rem;color:var(--text);cursor:pointer;transition:all .2s}
.type-btn.active{background:var(--rose);color:#fff;border-color:var(--rose)}
.type-btn:active{transform:scale(.96)}
.side-btns{display:flex;gap:6px}
.side-btn{flex:1;padding:8px;border-radius:12px;border:1.5px solid var(--gold-light);background:#fff;font-family:'Zen Maru Gothic',sans-serif;font-size:.78rem;color:var(--text);cursor:pointer;text-align:center;transition:all .2s}
.side-btn.active{background:var(--blush);color:#fff;border-color:var(--blush)}
.num-input-row{display:flex;align-items:center;gap:8px}
.num-input{width:80px;padding:8px 10px;border-radius:10px;border:1.5px solid var(--gold-light);font-family:'Zen Maru Gothic',sans-serif;font-size:1rem;text-align:center;color:var(--text);background:#fff}
.num-input:focus{outline:none;border-color:var(--rose)}
.num-unit{font-size:.78rem;color:var(--text-light)}
.time-input{padding:8px 12px;border-radius:10px;border:1.5px solid var(--gold-light);font-family:'Zen Maru Gothic',sans-serif;font-size:.9rem;color:var(--text);background:#fff}
.time-input:focus{outline:none;border-color:var(--rose)}
.memo-input{width:100%;padding:8px 10px;border-radius:10px;border:1.5px solid var(--gold-light);font-family:'Zen Maru Gothic',sans-serif;font-size:.8rem;color:var(--text);background:#fff;resize:none;height:36px}
.memo-input:focus{outline:none;border-color:var(--rose)}
.submit-btn{width:100%;padding:12px;border:none;border-radius:12px;background:var(--rose);color:#fff;font-family:'Zen Maru Gothic',sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .2s;margin-top:4px}
.submit-btn:active{transform:scale(.98);opacity:.9}
.submit-btn:disabled{background:var(--gold-light);color:var(--text-light)}
.cond-field{display:none}.cond-field.show{display:block}
.log-list{margin-top:8px}
.log-date-header{font-size:.72rem;color:var(--text-light);margin:16px 0 6px;padding-bottom:4px;border-bottom:1px solid rgba(200,164,110,.12)}
.log-item{display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid rgba(200,164,110,.06)}
.log-time{font-size:.78rem;font-weight:500;color:var(--deep);white-space:nowrap;min-width:42px;padding-top:1px}
.log-badge{display:inline-block;padding:2px 8px;border-radius:8px;font-size:.65rem;font-weight:500;color:#fff;white-space:nowrap}
.log-badge.breast{background:var(--blush)}.log-badge.formula{background:var(--gold)}.log-badge.mixed{background:#b39ddb}
.log-badge.pee{background:#ffca28;color:var(--text)}.log-badge.poop{background:#ff8a65}.log-badge.both{background:#a1887f}
.log-badge.temp-normal{background:#66bb6a}.log-badge.temp-high{background:#ef5350}.log-badge.temp-low{background:#42a5f5}
.log-badge.sleep-start{background:#7986cb}.log-badge.sleep-end{background:#ffb74d}
.log-detail{font-size:.75rem;color:var(--text);line-height:1.5}
.log-memo{font-size:.68rem;color:var(--text-light);margin-top:2px}
.log-body{flex:1}
.log-delete{padding:4px 8px;border:none;background:none;color:var(--text-light);font-size:.7rem;cursor:pointer;opacity:.5}
.log-delete:active{opacity:1;color:#e53935}
.placeholder{text-align:center;padding:60px 20px}
.placeholder-icon{font-size:2.5rem;margin-bottom:12px;opacity:.4}
.placeholder h3{font-size:1rem;font-weight:700;color:var(--deep);margin-bottom:8px}
.placeholder p{font-size:.82rem;color:var(--text-light);line-height:1.7}
.guide-section{margin-bottom:20px}
.guide-section h3{font-size:.9rem;font-weight:700;color:var(--deep);margin-bottom:6px;padding-left:12px;border-left:3px solid var(--blush)}
.guide-section p{font-size:.8rem;color:var(--text);line-height:1.8;margin-bottom:4px}
.guide-section .note{font-size:.75rem;color:var(--rose);margin-top:4px}
.guide-alert{margin-top:24px;padding:16px;background:#fff5f5;border:1.5px solid var(--rose);border-radius:12px}
.guide-alert h3{color:var(--rose);border-left-color:var(--rose);margin-bottom:10px}
.guide-alert ul{list-style:none;padding:0}
.guide-alert li{font-size:.78rem;color:#c62828;padding:3px 0 3px 14px;position:relative}
.guide-alert li::before{content:'';position:absolute;left:0;top:50%;width:5px;height:5px;background:var(--rose);border-radius:50%;transform:translateY(-50%)}
/* Guide accordion */
.guide-cat{background:#fff;border-radius:14px;margin-bottom:10px;border:1px solid rgba(200,164,110,.12);overflow:hidden}
.guide-cat-title{padding:14px 16px;font-size:.88rem;font-weight:700;color:var(--deep);cursor:pointer;display:flex;align-items:center;gap:8px;position:relative;user-select:none}
.guide-cat-title::after{content:'\25BE';position:absolute;right:16px;font-size:.7rem;color:var(--text-light);transition:transform .25s}
.guide-cat.open .guide-cat-title::after{transform:rotate(180deg)}
.guide-cat-body{max-height:0;overflow:hidden;transition:max-height .35s ease;padding:0 16px}
.guide-cat.open .guide-cat-body{max-height:3000px;padding:0 16px 14px}
/* Sleep bar */
.sleep-bar{height:18px;border-radius:9px;background:#e8eaf6;position:relative;margin:6px 0;overflow:hidden}
.sleep-bar .filled{height:100%;border-radius:9px;background:linear-gradient(90deg,#7986cb,#9fa8da)}
.sleep-hours-row{display:flex;justify-content:space-between;font-size:.65rem;color:var(--text-light)}
@media(min-width:600px){.hero{height:50dvh}.hero-name{font-size:4rem}.tab-btn{font-size:.8rem;padding:14px 14px 12px}.tab-content{padding:20px 24px 100px;max-width:640px;margin:0 auto}}
/* Login screen */
#loginScreen{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100dvh;background:var(--warm);padding:24px;text-align:center}
#loginScreen .login-logo{font-family:'Caveat',cursive;font-size:3.5rem;font-weight:600;color:var(--deep);margin-bottom:4px}
#loginScreen .login-sub{font-size:1rem;color:var(--rose);letter-spacing:.3em;margin-bottom:24px}
#loginScreen .login-desc{font-size:.82rem;color:var(--text-light);line-height:1.7;margin-bottom:32px}
.google-btn{display:inline-flex;align-items:center;gap:10px;padding:12px 28px;border:1.5px solid rgba(200,164,110,.3);border-radius:28px;background:#fff;font-family:'Zen Maru Gothic',sans-serif;font-size:.9rem;font-weight:500;color:var(--text);cursor:pointer;transition:all .2s;box-shadow:0 2px 8px rgba(107,58,74,.08)}
.google-btn:active{transform:scale(.97);box-shadow:0 1px 4px rgba(107,58,74,.12)}
.google-btn svg{width:20px;height:20px}
#appMain{display:none}
.user-bar{display:flex;align-items:center;justify-content:flex-end;padding:4px 12px;background:var(--tab-bg);font-size:.65rem;color:var(--text-light);gap:8px;border-bottom:1px solid rgba(200,164,110,.08)}
.user-bar img{width:20px;height:20px;border-radius:50%}
.logout-btn{border:none;background:none;font-family:'Zen Maru Gothic',sans-serif;font-size:.65rem;color:var(--text-light);cursor:pointer;text-decoration:underline}
.sync-indicator{font-size:.6rem;color:var(--rose);opacity:0;transition:opacity .3s}
.sync-indicator.show{opacity:1}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <div class="login-logo">mito</div>
  <div class="login-sub">深 音</div>
  <div class="login-desc">深音の育児記録アプリ。<br>ログインするとデータがクラウドに保存され、<br>どの端末からでもアクセスできます。</div>
  <button class="google-btn" id="googleLoginBtn">
    <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
    Googleでログイン
  </button>
</div>

<!-- APP MAIN (hidden until login) -->
<div id="appMain">

<div class="user-bar">
  <span class="sync-indicator" id="syncIndicator">同期中...</span>
  <img id="userPhoto" src="" alt="" style="display:none">
  <span id="userName"></span>
  <button class="logout-btn" id="logoutBtn">ログアウト</button>
</div>

<div class="hero" id="heroSection">
  <img src="hero.jpg" alt="深音">
  <div class="hero-overlay"></div>
  <div class="hero-text">
    <div class="hero-name">mito</div>
    <div class="hero-name-jp">深 音</div>
    <div class="hero-birthday">2026.02.19  18:40  born</div>
    <div class="hero-birth-stats">3054g / 50.5cm</div>
    <div class="hero-days" id="daysCount"></div>
  </div>
</div>

<div class="tab-bar">
  <button class="tab-btn active" data-tab="home"><span class="tab-icon">&#9679;</span>ホーム</button>
  <button class="tab-btn" data-tab="milk"><span class="tab-icon">&#9697;</span>授乳</button>
  <button class="tab-btn" data-tab="diaper"><span class="tab-icon">&#9675;</span>おむつ</button>
  <button class="tab-btn" data-tab="temp"><span class="tab-icon">&#9832;</span>体温</button>
  <button class="tab-btn" data-tab="sleep"><span class="tab-icon">&#9790;</span>睡眠</button>
  <button class="tab-btn" data-tab="growth"><span class="tab-icon">&#9651;</span>成長</button>
  <button class="tab-btn" data-tab="guide"><span class="tab-icon">&#9734;</span>ガイド</button>
</div>

<!-- HOME -->
<div class="tab-content active" id="tab-home">
  <div class="placeholder">
    <div class="placeholder-icon">&#10047;</div>
    <h3>深音のページへようこそ</h3>
    <p>授乳やおむつの記録、<br>体重・身長の成長記録を<br>ここにまとめていきます。</p>
  </div>
</div>

<!-- MILK -->
<div class="tab-content" id="tab-milk">
  <div class="section-title">今日の授乳</div>
  <div class="today-summary">
    <div class="summary-chip"><div class="num" id="milkCountToday">0</div><div class="label">回</div></div>
    <div class="summary-chip"><div class="num" id="milkBreastMin">0</div><div class="label">母乳(分)</div></div>
    <div class="summary-chip"><div class="num" id="milkFormulaMl">0</div><div class="label">ミルク(ml)</div></div>
    <div class="summary-chip"><div class="num" id="milkLastTime">--:--</div><div class="label">最後</div></div>
  </div>
  <div class="record-form">
    <div class="form-row"><span class="form-label">種類</span><div class="type-btns" id="milkType"><button class="type-btn" data-val="breast">母乳</button><button class="type-btn" data-val="formula">ミルク</button><button class="type-btn" data-val="mixed">混合</button></div></div>
    <div class="form-row cond-field" id="breastFields"><span class="form-label">左右 / 時間</span><div class="side-btns" style="margin-bottom:8px"><button class="side-btn" data-side="left">左</button><button class="side-btn" data-side="right">右</button><button class="side-btn" data-side="both">両方</button></div><div class="num-input-row"><span class="form-label" style="margin:0;min-width:20px">左</span><input type="number" class="num-input" id="breastLeftMin" placeholder="0" min="0" max="60"><span class="num-unit">分</span><span class="form-label" style="margin:0;min-width:20px;margin-left:8px">右</span><input type="number" class="num-input" id="breastRightMin" placeholder="0" min="0" max="60"><span class="num-unit">分</span></div></div>
    <div class="form-row cond-field" id="formulaFields"><span class="form-label">ミルク量</span><div class="num-input-row"><input type="number" class="num-input" id="formulaMl" placeholder="0" min="0" max="300" step="10"><span class="num-unit">ml</span></div></div>
    <div class="form-row"><span class="form-label">時刻</span><input type="time" class="time-input" id="milkTime"></div>
    <div class="form-row"><span class="form-label">メモ</span><textarea class="memo-input" id="milkMemo" placeholder="げっぷ出た、吐き戻しなど"></textarea></div>
    <button class="submit-btn" id="milkSubmit" disabled>記録する</button>
  </div>
  <div class="section-title">記録一覧</div>
  <div class="log-list" id="milkLog"></div>
</div>

<!-- DIAPER -->
<div class="tab-content" id="tab-diaper">
  <div class="section-title">今日のおむつ</div>
  <div class="today-summary">
    <div class="summary-chip"><div class="num" id="diaperCountToday">0</div><div class="label">回</div></div>
    <div class="summary-chip"><div class="num" id="diaperPeeCount">0</div><div class="label">おしっこ</div></div>
    <div class="summary-chip"><div class="num" id="diaperPoopCount">0</div><div class="label">うんち</div></div>
    <div class="summary-chip"><div class="num" id="diaperLastTime">--:--</div><div class="label">最後</div></div>
  </div>
  <div class="record-form">
    <div class="form-row"><span class="form-label">内容</span><div class="type-btns" id="diaperType"><button class="type-btn" data-val="pee">おしっこ</button><button class="type-btn" data-val="poop">うんち</button><button class="type-btn" data-val="both">両方</button></div></div>
    <div class="form-row cond-field" id="poopFields"><span class="form-label">うんちの状態</span><div class="type-btns" id="poopState"><button class="type-btn" data-val="normal">普通</button><button class="type-btn" data-val="soft">ゆるめ</button><button class="type-btn" data-val="hard">硬め</button><button class="type-btn" data-val="watery">水っぽい</button></div></div>
    <div class="form-row cond-field" id="poopColorField"><span class="form-label">うんちの色</span><div class="type-btns" id="poopColor"><button class="type-btn" data-val="yellow">黄色</button><button class="type-btn" data-val="green">緑</button><button class="type-btn" data-val="dark">黒緑</button><button class="type-btn" data-val="other">その他</button></div></div>
    <div class="form-row"><span class="form-label">時刻</span><input type="time" class="time-input" id="diaperTime"></div>
    <div class="form-row"><span class="form-label">メモ</span><textarea class="memo-input" id="diaperMemo" placeholder="量が多い、おむつかぶれなど"></textarea></div>
    <button class="submit-btn" id="diaperSubmit" disabled>記録する</button>
  </div>
  <div class="section-title">記録一覧</div>
  <div class="log-list" id="diaperLog"></div>
</div>

<!-- TEMP -->
<div class="tab-content" id="tab-temp">
  <div class="section-title">今日の体温</div>
  <div class="today-summary">
    <div class="summary-chip"><div class="num" id="tempCount">0</div><div class="label">回</div></div>
    <div class="summary-chip"><div class="num" id="tempLatest">--.-</div><div class="label">最新(&#8451;)</div></div>
    <div class="summary-chip"><div class="num" id="tempHigh">--.-</div><div class="label">最高</div></div>
    <div class="summary-chip"><div class="num" id="tempLow">--.-</div><div class="label">最低</div></div>
  </div>
  <div class="record-form">
    <div class="form-row">
      <span class="form-label">体温</span>
      <div class="num-input-row">
        <input type="number" class="num-input" id="tempValue" placeholder="36.8" min="34" max="42" step="0.1" style="width:100px;font-size:1.3rem">
        <span class="num-unit">&#8451;</span>
      </div>
    </div>
    <div class="form-row">
      <span class="form-label">測定部位</span>
      <div class="type-btns" id="tempSite">
        <button class="type-btn active" data-val="armpit">脇</button>
        <button class="type-btn" data-val="ear">耳</button>
        <button class="type-btn" data-val="forehead">おでこ</button>
      </div>
    </div>
    <div class="form-row"><span class="form-label">時刻</span><input type="time" class="time-input" id="tempTime"></div>
    <div class="form-row"><span class="form-label">メモ</span><textarea class="memo-input" id="tempMemo" placeholder="服を着せすぎてたかも、など"></textarea></div>
    <button class="submit-btn" id="tempSubmit">記録する</button>
  </div>
  <div class="section-title">記録一覧</div>
  <div class="log-list" id="tempLog"></div>
</div>

<!-- SLEEP -->
<div class="tab-content" id="tab-sleep">
  <div class="section-title">今日の睡眠</div>
  <div class="today-summary">
    <div class="summary-chip"><div class="num" id="sleepTotal">0h0m</div><div class="label">合計</div></div>
    <div class="summary-chip"><div class="num" id="sleepCount">0</div><div class="label">回</div></div>
    <div class="summary-chip"><div class="num" id="sleepStatus">--</div><div class="label">現在</div></div>
  </div>

  <!-- Sleep timeline bar -->
  <div style="background:#fff;border-radius:12px;padding:12px;margin-bottom:16px;border:1px solid rgba(200,164,110,.12)">
    <div class="sleep-hours-row"><span>0時</span><span>6時</span><span>12時</span><span>18時</span><span>24時</span></div>
    <div class="sleep-bar"><div class="filled" id="sleepBarFill" style="width:0%"></div></div>
    <div id="sleepTimeline"></div>
  </div>

  <div style="display:flex;gap:8px;margin-bottom:16px">
    <button class="submit-btn" id="sleepStartBtn" style="background:#7986cb">寝た</button>
    <button class="submit-btn" id="sleepEndBtn" style="background:#ffb74d;color:var(--text)">起きた</button>
  </div>

  <div class="record-form">
    <div class="section-title" style="margin-bottom:8px">手動で追加</div>
    <div class="form-row">
      <span class="form-label">種類</span>
      <div class="type-btns" id="sleepType">
        <button class="type-btn" data-val="start">寝た</button>
        <button class="type-btn" data-val="end">起きた</button>
      </div>
    </div>
    <div class="form-row"><span class="form-label">時刻</span><input type="time" class="time-input" id="sleepTime"></div>
    <div class="form-row"><span class="form-label">メモ</span><textarea class="memo-input" id="sleepMemo" placeholder="ぐずった、授乳で起きたなど"></textarea></div>
    <button class="submit-btn" id="sleepSubmit" disabled>記録する</button>
  </div>
  <div class="section-title">記録一覧</div>
  <div class="log-list" id="sleepLog"></div>
</div>

<!-- GROWTH -->
<div class="tab-content" id="tab-growth">
  <div class="section-title">成長のきろく</div>
  <div class="today-summary">
    <div class="summary-chip"><div class="num" id="growthWeight">--</div><div class="label">体重(g)</div></div>
    <div class="summary-chip"><div class="num" id="growthHeight">--</div><div class="label">身長(cm)</div></div>
    <div class="summary-chip"><div class="num" id="growthHead">--</div><div class="label">頭囲(cm)</div></div>
    <div class="summary-chip"><div class="num" id="growthDiff">--</div><div class="label">出生比(g)</div></div>
  </div>
  <div style="background:#fff;border-radius:16px;padding:12px;margin-bottom:16px;border:1px solid rgba(200,164,110,.12)">
    <div style="display:flex;gap:6px;margin-bottom:8px"><button class="type-btn active" id="chartWeight" onclick="switchChart('weight')">体重</button><button class="type-btn" id="chartHeight" onclick="switchChart('height')">身長</button></div>
    <canvas id="growthChart" width="600" height="280" style="width:100%;height:auto"></canvas>
  </div>
  <div class="record-form">
    <div class="form-row"><span class="form-label">日付</span><input type="date" class="time-input" id="growthDate"></div>
    <div class="form-row"><span class="form-label">体重</span><div class="num-input-row"><input type="number" class="num-input" id="growthWeightIn" placeholder="3054" min="0" max="15000" step="1"><span class="num-unit">g</span></div></div>
    <div class="form-row"><span class="form-label">身長</span><div class="num-input-row"><input type="number" class="num-input" id="growthHeightIn" placeholder="50.5" min="0" max="120" step="0.1"><span class="num-unit">cm</span></div></div>
    <div class="form-row"><span class="form-label">頭囲（任意）</span><div class="num-input-row"><input type="number" class="num-input" id="growthHeadIn" placeholder="" min="0" max="60" step="0.1"><span class="num-unit">cm</span></div></div>
    <div class="form-row"><span class="form-label">メモ</span><textarea class="memo-input" id="growthMemo" placeholder="1か月健診、など"></textarea></div>
    <button class="submit-btn" id="growthSubmit">記録する</button>
  </div>
  <div class="section-title">記録一覧</div>
  <div class="log-list" id="growthLog"></div>
</div>

<!-- GUIDE -->
<div class="tab-content" id="tab-guide">
  <div style="font-size:.8rem;color:var(--text-light);text-align:center;margin-bottom:14px">タップで開閉できます</div>

  <!-- カテゴリ1: からだのこと -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x1F476; からだのこと</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>おしっこ</h3><p>十分にミルク・母乳を飲んでいれば、薄い色のおしっこが1日6〜8回出ます。</p><p class="note">※ オレンジ色の尿 → 腎臓が未熟なため。出血ではなく自然になくなります。</p></div>
      <div class="guide-section"><h3>うんち</h3><p>生後すぐは黒緑色（胎便）、2〜3日で黄色混じり、4〜5日で黄色い泥状に。母乳中心だと水っぽく、ミルク中心だとやや硬め。</p><p class="note">※ 1日出ない・お腹が張る → 綿棒で肛門を刺激。色は便色カードで確認。</p></div>
      <div class="guide-section"><h3>嘔吐（溢乳）</h3><p>げっぷと一緒に少量吐いたり、口からミルクが流れるのは「溢乳（いつにゅう）」。赤ちゃんの胃は吐きやすい形なので心配いりません。</p><p class="note">！ 授乳のたびに噴水のように吐く場合は受診してください。</p></div>
      <div class="guide-section"><h3>黄疸（おうだん）</h3><p>肌や白目が黄色くなる生理的黄疸は、日本人の赤ちゃんの90%以上に出現。肝臓が未熟でビリルビンを排出しにくいため。生後4〜5日がピーク、1〜2週間で落ち着きます。</p><p class="note">※ 母乳育児で1か月以上続くこともあるが、元気で飲みがよければ安心。</p></div>
      <div class="guide-section"><h3>体温</h3><p>新生児の平熱は大人より高めの37.0℃前後。体温調節が未熟で、些細なことで上がりやすい。高い時は室温や服を調整し、脇で再測定を。</p><p class="note">※ 耳の体温計は誤差が大きいので、脇での測定がおすすめ。</p></div>
      <div class="guide-section"><h3>鼻・くしゃみ・しゃっくり</h3><p>フガフガ・グーグーという音は鼻の穴が狭いだけ。粘膜が敏感でくしゃみが多く、横隔膜が未熟でしゃっくりも頻繁。すべて心配不要です。</p></div>
      <div class="guide-section"><h3>スキンケア</h3><p>おむつかぶれ：こまめに替え、優しく拭く。ひどい時はお湯で洗い流す。首・耳の後ろ・脇は密着部分がただれやすいので、しっかり洗いましょう。</p></div>
      <div class="guide-section"><h3>赤ちゃんの免疫</h3><p>お母さんからもらった免疫と母乳の免疫で守られています。生後半年頃までは病気にかかりにくいと言われています。</p></div>
    </div>
  </div>

  <!-- カテゴリ2: 授乳 -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x1F37C; 授乳・ミルク</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>帰宅後の授乳準備</h3><p>退院直前に授乳をしますが、帰ってすぐ次の授乳時間になります。退院時に母乳だけで育児できる人は少ないです。ミルク、哺乳瓶や搾乳器の消毒を事前に済ませておきましょう。</p><p class="note">病院が使用しているミルクメーカーは決まっていません。ミルク缶は開封から1か月の使用期限です。まずは小さいミルク缶を準備しておきましょう。</p></div>
      <div class="guide-section"><h3>授乳時間と回数</h3><p>退院後は、赤ちゃんが泣いたら授乳をする「自律授乳」で育てていきましょう。赤ちゃんは胃が小さく、一度にたくさんの量を飲めません。お腹が空いているのに眠り続けることもあります。</p><p class="note">！ 1か月健診までは<strong style="color:var(--rose)">3時間空いたら起こして</strong>授乳をしましょう。母乳は欲しがるサインがあれば何回でもOK。ミルクは母乳よりカロリーが高く消化吸収が悪いため、3時間は空けるようにしましょう。</p></div>
      <div class="guide-section"><h3>飲ませる量</h3><p>退院時に、どれぐらい母乳が出ているか、赤ちゃんの大きさ、生まれてからの日数などから、産後健診1までの授乳方法を個別で説明されます。</p><p class="note">新生児は満腹を感じる機能が発達しておらず、与えれば与えるだけミルクを飲むため注意しましょう。薄めたり目分量で作らないように。満1か月以降のミルクだけの目安量が缶に明記されています。</p></div>
    </div>
  </div>

  <!-- カテゴリ3: 沐浴・お臍ケア -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x1F6C1; 沐浴・お臍ケア</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>なぜ沐浴が必要？</h3><p>新生児は大人の2倍もの汗をかき、皮脂がたくさん分泌されます。しかし、お肌のバリア機能が充分でなく、臍の緒の付け根も乾燥しておらず、大人と一緒の浴槽に入ると感染を起こしやすいです。</p><p class="note">1か月健診が終わるまでは、大人と一緒の入浴は避け、沐浴を行いましょう。</p></div>
      <div class="guide-section"><h3>インバスとアウトバス</h3><p><strong>インバス：</strong>お湯の中で赤ちゃんを洗う方法。赤ちゃんが泣いたり動くので支えるのが難しい。<br><strong>アウトバス：</strong>沐浴用のマットやお湯の入っていないベビーバスにタオルを敷き、寝かせて洗う方法。赤ちゃんを支える必要がなく、初めて沐浴する人でも安心です。</p></div>
      <div class="guide-section"><h3>沐浴の時間帯</h3><p>朝・昼・夜いつでもかまいません。大人が二人以上いる時が好ましいです。赤ちゃんの生活リズムをつけるためには、毎日同じような時間帯がいいでしょう。</p><p class="note">沐浴後に興奮して寝つかない場合は、お昼に沐浴することをおすすめします。</p></div>
      <div class="guide-section"><h3>沐浴する場所</h3><p>中腰の体勢は体への負担が大きく、立って洗う方が楽にできます。室温は適切か、着替えのスペースはあるか、マットやベビーバスが置けるか、お湯の準備や破棄が簡単にできるかを確認しましょう。</p><p class="note">！ お風呂の浴槽の蓋の上は転落する危険があるのでやめましょう。</p></div>
      <div class="guide-section"><h3>お臍のそうじ</h3><p>沐浴の後、毎日お臍のそうじをしましょう。臍の緒がついていても、とれた後でも、同じように1か月健診まで続けてください。</p><p>用意するもの：<strong>綿棒1〜2本</strong>（ベビー用ではなく、普通の綿棒で大丈夫です）</p></div>
      <div class="guide-section"><h3>お臍そうじの手順</h3><p>おしっこやうんちをしてもいいように、おむつを敷きかるく当てておきます。綿棒を片手で持ち、もう片方の手はお臍の根元が見えるようにお臍を広げます。綿棒を転がすように、お臍の根元の水分や汚れを拭き取ります。片側が終わったらもう片側も同じように。</p><p class="note">そうじをしている時に赤ちゃんが泣くことがあります。痛々しく見えるかもしれませんが、臍の緒は神経が通っていないため赤ちゃんは痛くありません。</p></div>
      <div class="guide-section"><h3>臍の緒がまだ付いている時</h3><p>乾燥して硬くなっているお臍を立てて、根元の部分をしっかり拭き取りましょう。お臍がとれて根元がしっかり乾燥するまで、毎日沐浴のあとに続けましょう。</p><p class="note">臍の緒は、お母さんから赤ちゃんへ栄養を運ぶための血液が流れていたので、取れた後にじわっと出血したり、かさぶたのように血のかたまりが付くこともありますが心配ありません。</p></div>
    </div>
  </div>

  <!-- カテゴリ4: 生活リズム・寝かしつけ -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x1F319; 生活リズム・寝かしつけ</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>退院直後のリズム</h3><p>次の授乳までずっと眠っていることは少なく、お腹の中にいた時と同様に30分前後で起きてくることもあります。夜行性で、お腹の中で一番動いていた時間が活発なこともあります。</p><p class="note">夜、寝る前にミルクをたくさん飲ませたり、部屋の照明を消すなどは効果がありません。体内時計が整うまでしばらく待ちましょう。</p></div>
      <div class="guide-section"><h3>生後2週間頃</h3><p>わずか2週間でも、少しずつ要求してくるようになります。横抱っこを嫌がる→縦で抱っこ！　座ってるのがわかるの？→立って、ゆらゆらして！　抱っこで寝たのに布団に寝かせると起きる（背中スイッチ）…など。</p><p class="note">泣き声が大きくなり焦るかもしれませんが、赤ちゃんが眠るには安心させてあげることが一番大切です。</p></div>
      <div class="guide-section"><h3>生後1か月頃</h3><p>この頃から夜行性が終わり、夜の方が寝てくれるようになり少し楽に感じる時期です。その反面、昼は授乳の後でも起きており、かまってほしいといった要求が強くなります。</p><p class="note">お腹が空いた時、眠い時、甘えている時など、泣き方に変化が出てくるので要求がわかりやすくなります。お腹がいっぱいで抱っこされている幸せなタイミングで「にこっ」と笑う表情もたくさん見られるようになります。</p></div>
      <div class="guide-section"><h3>泣き止まない時</h3><p>「寝てくれない」と思い、ミルクをどんどん飲ませると、苦しくて泣いたり、吐いたりと逆効果になることもあります。自分に余裕がない時に泣き続けられると、イライラしてしまって当然です。</p><p class="note">！ そんな時は「揺さぶられっ子症候群」を思い出してください。激しく揺さぶることは絶対にやめましょう。抱き癖がつくと言われることもありますが、放っておくよりも抱っこで安心させてあげましょう。</p></div>
      <div class="guide-section"><h3>安心して眠れる方法を探そう</h3><p>赤ちゃんにとって安心できる方法はさまざまです。添い寝でトントン♪（お母さんの匂いが大好き）、ミルクのあと抱っこでゆらゆら♪、おひな巻き（お腹の中にいた時と同じ手足を曲げ丸く包んであげる）など、おっぱいに代わる技を見つけましょう。</p></div>
    </div>
  </div>

  <!-- カテゴリ5: 事故予防 -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x26A0;&#xFE0F; 事故予防</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>転落</h3><p>新生児は寝返りができませんが、足で蹴る力が十分にあり、自力で180度回転します。ベッドの柵は必ず上げ、ベビーバスチェアなどではベルトを装着しましょう。</p><p class="note">！ 一瞬でもソファやベッドの端に寝かせてはいけません。一番重たい頭から転落します。</p></div>
      <div class="guide-section"><h3>窒息</h3><p>偶然手に届いたもので顔を覆うことがあります。寝返りができるようになるまでは、赤ちゃんの周りにおもちゃやタオルは置かないようにしましょう。布団は硬いものを使用し、ベッドと壁の隙間に注意。</p><p class="note">！ 掛布団の上やクッションに寝かすことは止めましょう。</p></div>
      <div class="guide-section"><h3>SIDS（乳幼児突然死症候群）</h3><p>赤ちゃんが眠っている間に突然死亡してしまうことをいい、日本では年間150件くらい発生しています。要因として、うつぶせ寝や喫煙が考えられています。</p><p class="note">1歳になるまでうつぶせ寝はやめ、仰向けで寝かせましょう。赤ちゃんがいる部屋での喫煙や、喫煙後すぐに近づくことは避けましょう。</p></div>
      <div class="guide-alert" style="margin-top:8px"><h3>退院直後の事故に注意</h3><ul><li>育児に慣れていない時期こそ予測がつかず事故につながる</li><li>事故は一瞬の隙、油断で起こる</li><li>家族みんなで気をつけましょう</li></ul></div>
    </div>
  </div>

  <!-- カテゴリ6: 退院・おうちの準備 -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x1F3E0; 退院・おうちの準備</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>退院の交通手段</h3><p>新生児は免疫が少ないため、公共交通機関はおすすめできません。食事や買い物などの寄り道はせず、直接ご自宅やご実家へ帰りましょう。</p><p class="note">自家用車の場合、チャイルドシートの準備を。初めて使用する場合は事前に設置・練習しておきましょう。</p></div>
      <div class="guide-section"><h3>お部屋の準備</h3><p>赤ちゃんをどこに寝かせるか決めましょう。物が落ちてこないか、すきま風や直射日光・冷暖房の風が直接当たらないか確認。間取りによって昼と夜で過ごす場所を変えてもOKですが、常に目が届く場所にしましょう。</p><p class="note">実家に帰る方は、自宅のお部屋も同時に考えておくと安心です。</p></div>
    </div>
  </div>

  <!-- カテゴリ7: 1か月健診に向けて -->
  <div class="guide-cat" onclick="this.classList.toggle('open')">
    <div class="guide-cat-title">&#x1F4C5; 1か月健診に向けて</div>
    <div class="guide-cat-body">
      <div class="guide-section"><h3>外気浴</h3><p>生後3週間頃になったら、お顔に直接日光が当たらないよう、気候の良い時間にベランダや庭に出て、外の空気や音に触れさせてみましょう。</p></div>
      <div class="guide-section"><h3>外出準備</h3><p>生活に余裕が出たら、抱っこ紐やベビーカーの準備をし、家の中で試してみましょう。</p></div>
    </div>
  </div>

  <!-- 病院相談 (常に表示) -->
  <div class="guide-alert" style="margin-top:20px"><h3>こんなときは病院に相談</h3><ul><li>便の色が便色カード1〜3番</li><li>授乳のたびに噴水状に吐く</li><li>黄疸が強く感じる</li><li>おへその赤み・臭いが強い</li><li>38℃以上の発熱が続く</li><li>ぐったり・飲みが悪い</li></ul></div>

  <div style="text-align:center;margin-top:20px;font-size:.65rem;color:var(--text-light)">出典：大阪市立総合医療センター すみれ9病棟</div>
</div>

<script>
// ===== Firebase Init =====
firebase.initializeApp({
  apiKey:"AIzaSyBWc0asofvf7_jHgxefL1t5WnMmnEad_5o",
  authDomain:"mito-baby.firebaseapp.com",
  projectId:"mito-baby",
  storageBucket:"mito-baby.firebasestorage.app",
  messagingSenderId:"320050386670",
  appId:"1:320050386670:web:b01701ad73c0b05518c5ff"
});
const auth=firebase.auth(),db=firebase.firestore();
let uid=null;

// ===== Auth =====
// Handle redirect result first
auth.getRedirectResult().then(result=>{
  if(result.user)console.log('Redirect login success:',result.user.displayName);
}).catch(e=>console.warn('Redirect error:',e));

document.getElementById('googleLoginBtn').addEventListener('click',()=>{
  const provider=new firebase.auth.GoogleAuthProvider();
  const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if(isMobile){auth.signInWithRedirect(provider)}
  else{auth.signInWithPopup(provider).catch(e=>{
    if(e.code==='auth/popup-blocked'){auth.signInWithRedirect(provider)}
    else{alert('ログインエラー: '+e.message)}
  })}
});
document.getElementById('logoutBtn').addEventListener('click',()=>{if(confirm('ログアウトしますか？'))auth.signOut()});

auth.onAuthStateChanged(async user=>{
  if(user){
    uid=user.uid;
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('appMain').style.display='block';
    if(user.photoURL){document.getElementById('userPhoto').src=user.photoURL;document.getElementById('userPhoto').style.display=''}
    document.getElementById('userName').textContent=user.displayName||'';
    await migrateLocalData();
    await initApp();
  }else{
    uid=null;
    document.getElementById('loginScreen').style.display='flex';
    document.getElementById('appMain').style.display='none';
  }
});

// ===== Firestore =====
function userDoc(){return db.collection('users').doc(uid)}
const KEYS=['mito_milk','mito_diaper','mito_temp','mito_sleep','mito_growth'];
let cache={};KEYS.forEach(k=>cache[k]=[]);

function load(k){return cache[k]||[]}
async function save(k,d){
  cache[k]=d;
  try{localStorage.setItem(k,JSON.stringify(d))}catch{}
  if(!uid)return;showSync();
  try{await userDoc().collection('data').doc(k).set({items:d,updated:firebase.firestore.FieldValue.serverTimestamp()})}catch(e){console.warn('Save error:',e)}
  hideSync();
}
async function loadAll(){
  if(!uid)return;showSync();
  try{const snap=await userDoc().collection('data').get();snap.forEach(doc=>{if(KEYS.includes(doc.id)&&doc.data().items)cache[doc.id]=doc.data().items})}
  catch(e){console.warn('Load error:',e);KEYS.forEach(k=>{try{cache[k]=JSON.parse(localStorage.getItem(k))||[]}catch{cache[k]=[]}})}
  hideSync();
}
function showSync(){document.getElementById('syncIndicator').classList.add('show')}
function hideSync(){setTimeout(()=>document.getElementById('syncIndicator').classList.remove('show'),500)}

async function migrateLocalData(){
  for(const k of KEYS){try{
    const local=JSON.parse(localStorage.getItem(k))||[];if(!local.length)continue;
    const doc=await userDoc().collection('data').doc(k).get();
    if(doc.exists&&doc.data().items&&doc.data().items.length>0){
      const existing=new Set(doc.data().items.map(r=>r.id));
      const nr=local.filter(r=>!existing.has(r.id));
      if(nr.length){const m=[...doc.data().items,...nr];m.sort((a,b)=>(b.date||'').localeCompare(a.date||'')||(b.time||'').localeCompare(a.time||''));
      await userDoc().collection('data').doc(k).set({items:m,updated:firebase.firestore.FieldValue.serverTimestamp()})}
    }else{await userDoc().collection('data').doc(k).set({items:local,updated:firebase.firestore.FieldValue.serverTimestamp()})}
  }catch(e){console.warn('Migrate:',e)}}
}

// ===== App =====
const BIRTH=new Date(2026,1,19),BIRTH_W=3054,BIRTH_H=50.5;
const todayStr=()=>new Date().toISOString().slice(0,10);
const nowTime=()=>{const d=new Date();return String(d.getHours()).padStart(2,'0')+':'+String(d.getMinutes()).padStart(2,'0')};
function daysSince(dateStr){return Math.floor((new Date(dateStr)-BIRTH)/864e5)+1}

async function initApp(){
  await loadAll();
  document.getElementById('daysCount').textContent='生後 '+(Math.floor((new Date()-BIRTH)/864e5)+1)+' 日目';
  let gd=load('mito_growth');if(!gd.length){gd.push({id:1,date:'2026-02-19',weight:BIRTH_W,height:BIRTH_H,head:null,memo:'出生時'});await save('mito_growth',gd)}
  document.getElementById('milkTime').value=nowTime();document.getElementById('diaperTime').value=nowTime();
  document.getElementById('tempTime').value=nowTime();document.getElementById('sleepTime').value=nowTime();
  document.getElementById('growthDate').value=todayStr();
  renderMilk();renderDiaper();renderTemp();renderSleep();renderGrowth();
}

const heroEl=document.getElementById('heroSection');
document.querySelectorAll('.tab-btn').forEach(btn=>{btn.addEventListener('click',()=>{const t=btn.dataset.tab;document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');document.querySelectorAll('.tab-content').forEach(c=>{c.classList.remove('active');if(c.id==='tab-'+t)c.classList.add('active')});heroEl.style.display=t==='home'?'':'none';if(t!=='home')window.scrollTo(0,0);if(t==='growth')setTimeout(drawChart,50)})});
function setupGroup(id,cb){const el=document.getElementById(id);if(!el)return;el.querySelectorAll('.type-btn').forEach(b=>b.addEventListener('click',()=>{el.querySelectorAll('.type-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');if(cb)cb(b.dataset.val)}))}

// MILK
let milkSide=null;
setupGroup('milkType',v=>{document.getElementById('breastFields').classList.toggle('show',v==='breast'||v==='mixed');document.getElementById('formulaFields').classList.toggle('show',v==='formula'||v==='mixed');document.getElementById('milkSubmit').disabled=false});
document.querySelectorAll('#breastFields .side-btn').forEach(b=>b.addEventListener('click',()=>{document.querySelectorAll('#breastFields .side-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');milkSide=b.dataset.side}));
document.getElementById('milkSubmit').addEventListener('click',async()=>{const te=document.querySelector('#milkType .type-btn.active');if(!te)return;const r={id:Date.now(),date:todayStr(),time:document.getElementById('milkTime').value||nowTime(),type:te.dataset.val,leftMin:parseInt(document.getElementById('breastLeftMin').value)||0,rightMin:parseInt(document.getElementById('breastRightMin').value)||0,side:milkSide,formulaMl:parseInt(document.getElementById('formulaMl').value)||0,memo:document.getElementById('milkMemo').value.trim()};const d=load('mito_milk');d.unshift(r);await save('mito_milk',d);document.querySelectorAll('#milkType .type-btn,#breastFields .side-btn').forEach(b=>b.classList.remove('active'));['breastFields','formulaFields'].forEach(id=>document.getElementById(id).classList.remove('show'));['breastLeftMin','breastRightMin','formulaMl'].forEach(id=>document.getElementById(id).value='');document.getElementById('milkMemo').value='';document.getElementById('milkTime').value=nowTime();document.getElementById('milkSubmit').disabled=true;milkSide=null;renderMilk()});
function renderMilk(){const data=load('mito_milk'),today=todayStr(),td=data.filter(r=>r.date===today);document.getElementById('milkCountToday').textContent=td.length;document.getElementById('milkBreastMin').textContent=td.reduce((s,r)=>s+(r.leftMin||0)+(r.rightMin||0),0);document.getElementById('milkFormulaMl').textContent=td.reduce((s,r)=>s+(r.formulaMl||0),0);document.getElementById('milkLastTime').textContent=td.length?td[0].time:'--:--';const el=document.getElementById('milkLog');if(!data.length){el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-light);font-size:.8rem">まだ記録がありません</div>';return}const TL={breast:'母乳',formula:'ミルク',mixed:'混合'},SL={left:'左',right:'右',both:'両方'};let h='',ld='';data.forEach(r=>{if(r.date!==ld){h+='<div class="log-date-header">'+r.date.replace(/-/g,'/')+'（生後'+daysSince(r.date)+'日）</div>';ld=r.date}let det=TL[r.type]||'';if(r.type==='breast'||r.type==='mixed'){const p=[];if(r.side)p.push(SL[r.side]||'');if(r.leftMin)p.push('左'+r.leftMin+'分');if(r.rightMin)p.push('右'+r.rightMin+'分');if(p.length)det+=' '+p.join(' / ')}if((r.type==='formula'||r.type==='mixed')&&r.formulaMl)det+=' '+r.formulaMl+'ml';h+='<div class="log-item"><div class="log-time">'+r.time+'</div><div class="log-body"><span class="log-badge '+r.type+'">'+(TL[r.type]||'')+'</span> <span class="log-detail">'+det+'</span>'+(r.memo?'<div class="log-memo">'+r.memo+'</div>':'')+'</div><button class="log-delete" data-key="mito_milk" data-id="'+r.id+'">&#10005;</button></div>'});el.innerHTML=h}

// DIAPER
let dpState=null,dpColor=null;
setupGroup('diaperType',v=>{const sp=v==='poop'||v==='both';document.getElementById('poopFields').classList.toggle('show',sp);document.getElementById('poopColorField').classList.toggle('show',sp);document.getElementById('diaperSubmit').disabled=false});
setupGroup('poopState',v=>{dpState=v});setupGroup('poopColor',v=>{dpColor=v});
document.getElementById('diaperSubmit').addEventListener('click',async()=>{const te=document.querySelector('#diaperType .type-btn.active');if(!te)return;const r={id:Date.now(),date:todayStr(),time:document.getElementById('diaperTime').value||nowTime(),type:te.dataset.val,poopState:dpState,poopColor:dpColor,memo:document.getElementById('diaperMemo').value.trim()};const d=load('mito_diaper');d.unshift(r);await save('mito_diaper',d);document.querySelectorAll('#diaperType .type-btn,#poopState .type-btn,#poopColor .type-btn').forEach(b=>b.classList.remove('active'));['poopFields','poopColorField'].forEach(id=>document.getElementById(id).classList.remove('show'));document.getElementById('diaperMemo').value='';document.getElementById('diaperTime').value=nowTime();document.getElementById('diaperSubmit').disabled=true;dpState=null;dpColor=null;renderDiaper()});
function renderDiaper(){const data=load('mito_diaper'),today=todayStr(),td=data.filter(r=>r.date===today);document.getElementById('diaperCountToday').textContent=td.length;document.getElementById('diaperPeeCount').textContent=td.filter(r=>r.type==='pee'||r.type==='both').length;document.getElementById('diaperPoopCount').textContent=td.filter(r=>r.type==='poop'||r.type==='both').length;document.getElementById('diaperLastTime').textContent=td.length?td[0].time:'--:--';const el=document.getElementById('diaperLog');if(!data.length){el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-light);font-size:.8rem">まだ記録がありません</div>';return}const TL={pee:'おしっこ',poop:'うんち',both:'両方'},STL={normal:'普通',soft:'ゆるめ',hard:'硬め',watery:'水っぽい'},CL={yellow:'黄色',green:'緑',dark:'黒緑',other:'その他'};let h='',ld='';data.forEach(r=>{if(r.date!==ld){h+='<div class="log-date-header">'+r.date.replace(/-/g,'/')+'（生後'+daysSince(r.date)+'日）</div>';ld=r.date}let det='';if(r.poopState)det+=STL[r.poopState]||'';if(r.poopColor)det+=(det?' / ':'')+(CL[r.poopColor]||'');h+='<div class="log-item"><div class="log-time">'+r.time+'</div><div class="log-body"><span class="log-badge '+r.type+'">'+(TL[r.type]||'')+'</span> '+(det?'<span class="log-detail">'+det+'</span>':'')+(r.memo?'<div class="log-memo">'+r.memo+'</div>':'')+'</div><button class="log-delete" data-key="mito_diaper" data-id="'+r.id+'">&#10005;</button></div>'});el.innerHTML=h}

// TEMP
let tempSite='armpit';setupGroup('tempSite',v=>{tempSite=v});
document.getElementById('tempSubmit').addEventListener('click',async()=>{const v=parseFloat(document.getElementById('tempValue').value);if(!v||v<34||v>42){alert('体温を入力してください');return}const r={id:Date.now(),date:todayStr(),time:document.getElementById('tempTime').value||nowTime(),temp:v,site:tempSite,memo:document.getElementById('tempMemo').value.trim()};const d=load('mito_temp');d.unshift(r);await save('mito_temp',d);document.getElementById('tempValue').value='';document.getElementById('tempMemo').value='';document.getElementById('tempTime').value=nowTime();renderTemp()});
function renderTemp(){const data=load('mito_temp'),today=todayStr(),td=data.filter(r=>r.date===today);document.getElementById('tempCount').textContent=td.length;const temps=td.map(r=>r.temp).filter(Boolean);document.getElementById('tempLatest').textContent=td.length?td[0].temp.toFixed(1):'--.-';document.getElementById('tempHigh').textContent=temps.length?Math.max(...temps).toFixed(1):'--.-';document.getElementById('tempLow').textContent=temps.length?Math.min(...temps).toFixed(1):'--.-';const el=document.getElementById('tempLog');if(!data.length){el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-light);font-size:.8rem">まだ記録がありません</div>';return}const SITE={armpit:'脇',ear:'耳',forehead:'おでこ'};let h='',ld='';data.forEach(r=>{if(r.date!==ld){h+='<div class="log-date-header">'+r.date.replace(/-/g,'/')+'（生後'+daysSince(r.date)+'日）</div>';ld=r.date}const cls=r.temp>=37.5?'temp-high':r.temp<36.0?'temp-low':'temp-normal';h+='<div class="log-item"><div class="log-time">'+r.time+'</div><div class="log-body"><span class="log-badge '+cls+'">'+r.temp.toFixed(1)+'&#8451;</span> <span class="log-detail">'+(SITE[r.site]||'')+'</span>'+(r.memo?'<div class="log-memo">'+r.memo+'</div>':'')+'</div><button class="log-delete" data-key="mito_temp" data-id="'+r.id+'">&#10005;</button></div>'});el.innerHTML=h}

// SLEEP
setupGroup('sleepType',()=>{document.getElementById('sleepSubmit').disabled=false});
async function addSleepRecord(type,time,memo){const r={id:Date.now(),date:todayStr(),time:time||nowTime(),type:type,memo:memo||''};const d=load('mito_sleep');d.unshift(r);await save('mito_sleep',d);renderSleep()}
document.getElementById('sleepStartBtn').addEventListener('click',()=>addSleepRecord('start',nowTime(),''));
document.getElementById('sleepEndBtn').addEventListener('click',()=>addSleepRecord('end',nowTime(),''));
document.getElementById('sleepSubmit').addEventListener('click',()=>{const te=document.querySelector('#sleepType .type-btn.active');if(!te)return;addSleepRecord(te.dataset.val,document.getElementById('sleepTime').value,document.getElementById('sleepMemo').value.trim());document.querySelectorAll('#sleepType .type-btn').forEach(b=>b.classList.remove('active'));document.getElementById('sleepMemo').value='';document.getElementById('sleepTime').value=nowTime();document.getElementById('sleepSubmit').disabled=true});
function renderSleep(){const data=load('mito_sleep'),today=todayStr(),td=data.filter(r=>r.date===today);const sorted=[...td].sort((a,b)=>a.time.localeCompare(b.time));let totalMin=0,sleeping=false,sleepStart='';sorted.forEach(r=>{if(r.type==='start'){sleeping=true;sleepStart=r.time}else if(r.type==='end'&&sleeping){const[sh,sm]=sleepStart.split(':').map(Number);const[eh,em]=r.time.split(':').map(Number);totalMin+=(eh*60+em)-(sh*60+sm);sleeping=false}});if(sleeping){const[sh,sm]=sleepStart.split(':').map(Number);const n=new Date();totalMin+=(n.getHours()*60+n.getMinutes())-(sh*60+sm)}const hrs=Math.floor(totalMin/60),mins=totalMin%60;document.getElementById('sleepTotal').textContent=hrs+'h'+mins+'m';document.getElementById('sleepCount').textContent=sorted.filter(r=>r.type==='start').length;const latest=td.length?td[0]:null;document.getElementById('sleepStatus').textContent=latest?(latest.type==='start'?'睡眠中':'起きてる'):'--';if(totalMin>0){document.getElementById('sleepBarFill').style.width=Math.min((totalMin/(24*60))*100,100)+'%'}else{document.getElementById('sleepBarFill').style.width='0%'}const el=document.getElementById('sleepLog');if(!data.length){el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-light);font-size:.8rem">まだ記録がありません</div>';return}const TL={start:'寝た',end:'起きた'};let h='',ld='';data.forEach(r=>{if(r.date!==ld){h+='<div class="log-date-header">'+r.date.replace(/-/g,'/')+'（生後'+daysSince(r.date)+'日）</div>';ld=r.date}h+='<div class="log-item"><div class="log-time">'+r.time+'</div><div class="log-body"><span class="log-badge sleep-'+r.type+'">'+(TL[r.type]||'')+'</span>'+(r.memo?' <span class="log-detail">'+r.memo+'</span>':'')+'</div><button class="log-delete" data-key="mito_sleep" data-id="'+r.id+'">&#10005;</button></div>'});el.innerHTML=h}

// GROWTH
let chartMode='weight';
document.getElementById('growthSubmit').addEventListener('click',async()=>{const w=parseFloat(document.getElementById('growthWeightIn').value),h=parseFloat(document.getElementById('growthHeightIn').value);if(!w&&!h){alert('体重か身長を入力してください');return}const r={id:Date.now(),date:document.getElementById('growthDate').value||todayStr(),weight:w||null,height:h||null,head:parseFloat(document.getElementById('growthHeadIn').value)||null,memo:document.getElementById('growthMemo').value.trim()};const d=load('mito_growth');d.push(r);d.sort((a,b)=>a.date.localeCompare(b.date));await save('mito_growth',d);['growthWeightIn','growthHeightIn','growthHeadIn'].forEach(id=>document.getElementById(id).value='');document.getElementById('growthMemo').value='';document.getElementById('growthDate').value=todayStr();renderGrowth()});
function switchChart(m){chartMode=m;document.getElementById('chartWeight').classList.toggle('active',m==='weight');document.getElementById('chartHeight').classList.toggle('active',m==='height');drawChart()}
function drawChart(){const canvas=document.getElementById('growthChart'),ctx=canvas.getContext('2d'),dpr=window.devicePixelRatio||1,rect=canvas.getBoundingClientRect();canvas.width=rect.width*dpr;canvas.height=rect.height*dpr;ctx.scale(dpr,dpr);const W=rect.width,H=rect.height;ctx.clearRect(0,0,W,H);const data=load('mito_growth').filter(r=>chartMode==='weight'?r.weight:r.height);if(data.length<1){ctx.fillStyle='#9a7a7a';ctx.font='13px "Zen Maru Gothic"';ctx.fillText('データがありません',W/2-60,H/2);return}const vals=data.map(r=>chartMode==='weight'?r.weight:r.height);const minV=Math.min(...vals)*.95,maxV=Math.max(...vals)*1.05;const pL=50,pR=16,pT=20,pB=36,cw=W-pL-pR,ch=H-pT-pB;ctx.strokeStyle='rgba(200,164,110,.15)';ctx.lineWidth=.5;for(let i=0;i<=4;i++){const y=pT+(ch/4)*i;ctx.beginPath();ctx.moveTo(pL,y);ctx.lineTo(W-pR,y);ctx.stroke();const v=maxV-(maxV-minV)*(i/4);ctx.fillStyle='#9a7a7a';ctx.font='10px "Zen Maru Gothic"';ctx.textAlign='right';ctx.fillText(chartMode==='weight'?Math.round(v)+'g':v.toFixed(1)+'cm',pL-6,y+4)}if(data.length===1){const x=pL+cw/2,y=pT+ch/2;ctx.fillStyle='#d4708a';ctx.beginPath();ctx.arc(x,y,5,0,Math.PI*2);ctx.fill();ctx.fillStyle='#4a3030';ctx.font='10px "Zen Maru Gothic"';ctx.textAlign='center';ctx.fillText(vals[0]+(chartMode==='weight'?'g':'cm'),x,y-10);ctx.fillText(data[0].date.slice(5).replace('-','/'),x,H-8);return}ctx.strokeStyle='#d4708a';ctx.lineWidth=2;ctx.lineJoin='round';ctx.beginPath();data.forEach((r,i)=>{const x=pL+(cw/(data.length-1))*i,v=chartMode==='weight'?r.weight:r.height,y=pT+ch-((v-minV)/(maxV-minV))*ch;i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.stroke();ctx.globalAlpha=.08;ctx.fillStyle='#d4708a';ctx.lineTo(pL+cw,pT+ch);ctx.lineTo(pL,pT+ch);ctx.fill();ctx.globalAlpha=1;data.forEach((r,i)=>{const x=pL+(cw/(data.length-1))*i,v=chartMode==='weight'?r.weight:r.height,y=pT+ch-((v-minV)/(maxV-minV))*ch;ctx.fillStyle='#d4708a';ctx.beginPath();ctx.arc(x,y,3.5,0,Math.PI*2);ctx.fill();ctx.fillStyle='#9a7a7a';ctx.font='9px "Zen Maru Gothic"';ctx.textAlign='center';const show=data.length<=10||i%Math.ceil(data.length/8)===0||i===data.length-1;if(show)ctx.fillText(r.date.slice(5).replace('-','/'),x,H-8)})}
function renderGrowth(){const data=load('mito_growth'),latest=data.length?data[data.length-1]:null;document.getElementById('growthWeight').textContent=latest&&latest.weight?latest.weight:'--';document.getElementById('growthHeight').textContent=latest&&latest.height?latest.height:'--';document.getElementById('growthHead').textContent=latest&&latest.head?latest.head:'--';if(latest&&latest.weight){const diff=latest.weight-BIRTH_W;document.getElementById('growthDiff').textContent=(diff>=0?'+':'')+diff}else{document.getElementById('growthDiff').textContent='--'}const el=document.getElementById('growthLog');if(!data.length){el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-light);font-size:.8rem">まだ記録がありません</div>';drawChart();return}let h='';[...data].reverse().forEach(r=>{let det='';if(r.weight)det+=r.weight+'g';if(r.height)det+=(det?' / ':'')+r.height+'cm';if(r.head)det+=(det?' / ':'')+'頭囲'+r.head+'cm';h+='<div class="log-item"><div class="log-time">'+r.date.slice(5).replace('-','/')+'</div><div class="log-body"><span class="log-detail">生後'+daysSince(r.date)+'日　'+det+'</span>'+(r.memo?'<div class="log-memo">'+r.memo+'</div>':'')+'</div>'+(r.id!==1?'<button class="log-delete" data-key="mito_growth" data-id="'+r.id+'">&#10005;</button>':'')+'</div>'});el.innerHTML=h;drawChart()}

// DELETE
document.addEventListener('click',async e=>{if(!e.target.classList.contains('log-delete'))return;if(!confirm('この記録を削除しますか？'))return;const k=e.target.dataset.key,id=parseInt(e.target.dataset.id);await save(k,load(k).filter(r=>r.id!==id));({mito_milk:renderMilk,mito_diaper:renderDiaper,mito_temp:renderTemp,mito_sleep:renderSleep,mito_growth:renderGrowth})[k]()});
</script>
</body>
</html>
